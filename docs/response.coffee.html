<!DOCTYPE html>

<html>
<head>
  <title>Response and associated API</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="esl.coffee.html">
                  esl.coffee.md
                </a>
              
                
                <a class="source" href="parser.coffee.html">
                  parser.coffee.md
                </a>
              
                
                <a class="source" href="response.coffee.html">
                  response.coffee.md
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1 id="response-and-associated-api">Response and associated API</h1>

            </div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreeSwitchError</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Error</span></span>
  constructor: <span class="hljs-function"><span class="hljs-params">(@res,@args)</span> -&gt;</span>
    <span class="hljs-keyword">super</span> JSON.stringify @args

<span class="hljs-built_in">module</span>.exports = <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FreeSwitchResponse</span></span></pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>The <code>FreeSwitchResponse</code> is bound to a single socket (dual-stream). For outbound (server) mode this would represent a single socket call from FreeSwitch.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  constructor: <span class="hljs-function"><span class="hljs-params">(@socket)</span> -&gt;</span>

    assert @socket?, <span class="hljs-string">'Missing socket parameter'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>The object provides <code>on</code>, <code>once</code>, and <code>emit</code> methods, which rely on an <a href="http://nodejs.org/api/events.html#events_class_events_eventemitter"><code>EventEmitter</code></a> object for dispatch.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @ev = <span class="hljs-keyword">new</span> EventEmitter()</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>The object also provides a queue for operations which need to be submitted one after another on a given socket because FreeSwitch does not provide ways to map event socket requests and responses in the general case.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @__queue = Promise.resolve <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>We also must track connection close in order to prevent writing to a closed socket.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @closed = <span class="hljs-literal">false</span>
    @socket.<span class="hljs-literal">on</span> <span class="hljs-string">'close'</span>, <span class="hljs-function">=&gt;</span>
      @closed = <span class="hljs-literal">true</span>
      trace <span class="hljs-string">'Socket closed'</span>
      @emit <span class="hljs-string">'socket-close'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>Default handler for <code>error</code> events to prevent <code>Unhandled &#39;error&#39; event</code> reports.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @socket.<span class="hljs-literal">on</span> <span class="hljs-string">'error'</span>, <span class="hljs-function"><span class="hljs-params">(err)</span> =&gt;</span>
      debug <span class="hljs-string">'Socket Error'</span>, {err}
      @emit <span class="hljs-string">'socket-error'</span>, err

    @__later = {}

    <span class="hljs-literal">null</span>

  error: <span class="hljs-function"><span class="hljs-params">(res,data)</span> -&gt;</span>
    debug <span class="hljs-string">"error"</span>, {res,data}
    Promise
      .reject <span class="hljs-keyword">new</span> FreeSwitchError res, data
      .bind <span class="hljs-keyword">this</span></pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <h1 id="queueing">Queueing</h1>

            </div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Enqueue a function that returns a Promise.
The function is only called when all previously enqueued functions-that-return-Promises are completed and their respective Promises fulfilled or rejected.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  enqueue: <span class="hljs-function"><span class="hljs-params">(f)</span> -&gt;</span>
    <span class="hljs-keyword">new</span> Promise (resolve,reject) =&gt;
<span class="hljs-function">      <span class="hljs-title">fulfilled</span> = <span class="hljs-params">(p)</span> -&gt;</span> resolve p
<span class="hljs-function">      <span class="hljs-title">rejected</span> = <span class="hljs-params">(e)</span> -&gt;</span> reject e
      @__queue = @__queue
        .<span class="hljs-keyword">then</span> -&gt; f()
        .<span class="hljs-keyword">then</span> fulfilled
        .<span class="hljs-keyword">catch</span> rejected
    .bind <span class="hljs-keyword">this</span></pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h1 id="event-emitter">Event Emitter</h1>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h2 id="emit">emit</h2>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>A single wrapper for EventEmitter.emit().</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  emit: <span class="hljs-function">-&gt;</span>
    trace <span class="hljs-string">'emit'</span>, arguments[<span class="hljs-number">0</span>], headers:arguments[<span class="hljs-number">1</span>]?.headers, body:arguments[<span class="hljs-number">1</span>]?.body
    outcome = @ev.emit arguments...
    trace emit:arguments[<span class="hljs-number">0</span>], had_listeners:outcome
    outcome</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <h2 id="once">once</h2>

            </div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Wraps EventEmitter.once() into a Promise; this allows you to write for example</p>
<pre><code class="lang-javascript"><span class="hljs-keyword">this</span>.once(<span class="hljs-string">'CHANNEL_COMPLETE'</span>).then(save_cdr).then(stop_recording);
</code></pre>

            </div>
            
            <div class="content"><div class='highlight'><pre>  once: <span class="hljs-function"><span class="hljs-params">(event,cb)</span> -&gt;</span>
    trace <span class="hljs-string">'create_once'</span>, event
    p = <span class="hljs-keyword">new</span> Promise (resolve,reject) =&gt;
      <span class="hljs-keyword">try</span>
        @ev.once event, <span class="hljs-function">=&gt;</span>
          trace <span class="hljs-string">'once'</span>, event, data:arguments[<span class="hljs-number">0</span>]
          resolve arguments...
          <span class="hljs-keyword">return</span>
        <span class="hljs-literal">null</span>
      <span class="hljs-keyword">catch</span> exception
        reject exception
    p = p.bind <span class="hljs-keyword">this</span></pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>In some cases the event might have been emitted before we are ready to receive it.
In that case we store the data in <code>@__later</code> so that we can emit the event when the recipient is ready.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> event <span class="hljs-keyword">of</span> @__later
      @emit event, @__later[event]
      <span class="hljs-keyword">delete</span> @__later[event]

    <span class="hljs-keyword">if</span> cb?
      <span class="hljs-keyword">return</span> p.<span class="hljs-keyword">then</span> cb

    <span class="hljs-keyword">return</span> p</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <h2 id="emit_later">emit_later</h2>

            </div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>This is used for events that might trigger before we set the <code>once</code> receiver.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  emit_later: <span class="hljs-function"><span class="hljs-params">(event,data)</span> -&gt;</span>
    trace <span class="hljs-string">'emit_later'</span>, {event, data}
    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> @emit event, data
      @__later[event] = data</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <h2 id="on">on</h2>
<p>A simple wrapper for EventEmitter.on().</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  on: <span class="hljs-function"><span class="hljs-params">(event,callback)</span> -&gt;</span>
    trace <span class="hljs-string">'create_on'</span>, event
    @ev.<span class="hljs-literal">on</span> event, <span class="hljs-function">=&gt;</span>
      trace <span class="hljs-string">'on'</span>, event, data:arguments[<span class="hljs-number">0</span>]
      callback.apply <span class="hljs-keyword">this</span>, arguments
      <span class="hljs-keyword">return</span></pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <h1 id="low-level-sending">Low-level sending</h1>

            </div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>These methods are normally not used directly.</p>
<h2 id="write">write</h2>

            </div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>Send a single command to FreeSwitch; <code>args</code> is a hash of headers sent with the command.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  write: <span class="hljs-function"><span class="hljs-params">(command,args)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> @closed
      <span class="hljs-keyword">return</span> @error {}, {when:<span class="hljs-string">'write on closed socket'</span>,command,args}

    p = <span class="hljs-keyword">new</span> Promise (resolve,reject) =&gt;
      <span class="hljs-keyword">try</span>
        trace <span class="hljs-string">'write'</span>, {command,args}

        text = <span class="hljs-string">"<span class="hljs-subst">#{command}</span>\n"</span>
        <span class="hljs-keyword">if</span> args?
          <span class="hljs-keyword">for</span> key, value <span class="hljs-keyword">of</span> args
            text += <span class="hljs-string">"<span class="hljs-subst">#{key}</span>: <span class="hljs-subst">#{value}</span>\n"</span>
        text += <span class="hljs-string">"\n"</span>
        @socket.write text, <span class="hljs-string">'utf8'</span>
        resolve <span class="hljs-literal">null</span>

      <span class="hljs-keyword">catch</span> error
        reject error

    p.bind <span class="hljs-keyword">this</span></pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <h2 id="send">send</h2>

            </div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>A generic way of sending commands to FreeSwitch, wrapping <code>write</code> into a Promise that waits for FreeSwitch’s notification that the command completed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  send: <span class="hljs-function"><span class="hljs-params">(command,args)</span> -&gt;</span>

    <span class="hljs-keyword">if</span> @closed
      <span class="hljs-keyword">return</span> @error {}, {when:<span class="hljs-string">'send on closed socket'</span>,command,args}</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>Typically <code>command/reply</code> will contain the status in the <code>Reply-Text</code> header while <code>api/response</code> will contain the status in the body.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @enqueue =&gt;
      p = @once <span class="hljs-string">'freeswitch_command_reply'</span>
        .<span class="hljs-keyword">then</span> (res) =&gt;
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> res?
          trace <span class="hljs-string">'send: received reply'</span>, res, {command,args}
          reply = res.headers[<span class="hljs-string">'Reply-Text'</span>]</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>The Promise might fail if FreeSwitch’s notification indicates an error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> reply?
            trace <span class="hljs-string">'send: no reply'</span>, {command, args}
            <span class="hljs-keyword">return</span> @error res, {when:<span class="hljs-string">'no reply to command'</span>,command,args}

          <span class="hljs-keyword">if</span> reply.match <span class="hljs-regexp">/^-/</span>
            debug <span class="hljs-string">'send: failed'</span>, reply, {command, args}
            <span class="hljs-keyword">return</span> @error res, {when:<span class="hljs-string">'command reply'</span>,reply,command,args}</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>The promise will be fulfilled with the <code>{headers,body}</code> object provided by the parser.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          trace <span class="hljs-string">'send: success'</span>, {command,args}
          res

      q = @write command, args

      q.<span class="hljs-keyword">then</span> -&gt; p</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <h2 id="end">end</h2>

            </div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Closes the socket.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  end: <span class="hljs-function"><span class="hljs-params">()</span> -&gt;</span>
    trace <span class="hljs-string">'end'</span>
    @closed = <span class="hljs-literal">true</span>
    @socket.end()
    <span class="hljs-keyword">this</span></pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <h1 id="channel-level-commands">Channel-level commands</h1>

            </div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <h2 id="api">api</h2>

            </div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Send an API command, see <a href="http://wiki.freeswitch.org/wiki/Mod_commands">Mod commands</a> for a list.
Returns a Promise that is fulfilled as soon as FreeSwitch sends a reply. Requests are queued and each request is matched with the first-coming response, since there is no way to match between requests and responses.
Use <code>bgapi</code> if you need to make sure responses are correct, since it provides the proper semantices.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  api: <span class="hljs-function"><span class="hljs-params">(command)</span> -&gt;</span>
    trace <span class="hljs-string">'api'</span>, {command}

    <span class="hljs-keyword">if</span> @closed
      <span class="hljs-keyword">return</span> @error {}, {when:<span class="hljs-string">'api on closed socket'</span>,command}

    @enqueue =&gt;
      p = @once <span class="hljs-string">'freeswitch_api_response'</span>
        .<span class="hljs-keyword">then</span> (res) =&gt;
          <span class="hljs-keyword">return</span> <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> res?
          trace <span class="hljs-string">'api: response'</span>, {command}
          reply = res.body</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>The Promise might fail if FreeSwitch indicates there was an error.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> reply?
            debug <span class="hljs-string">'api: no reply'</span>, {command}
            <span class="hljs-keyword">return</span> @error res, {when:<span class="hljs-string">'no reply to api'</span>,command}

          <span class="hljs-keyword">if</span> reply.match <span class="hljs-regexp">/^-/</span>
            debug <span class="hljs-string">'api response failed'</span>, {reply, command}
            <span class="hljs-keyword">return</span> @error res, {when:<span class="hljs-string">'api response'</span>,reply,command}</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>The Promise that will be fulfilled with <code>{headers,body,uuid}</code> from the parser; uuid is the API UUID if one is provided by FreeSwitch.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          res.uuid = (reply.match <span class="hljs-regexp">/^\+OK ([\da-f-]{36})/</span>)?[<span class="hljs-number">1</span>]
          res

      q = @write <span class="hljs-string">"api <span class="hljs-subst">#{command}</span>"</span>

      q.<span class="hljs-keyword">then</span> -&gt; p</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <h2 id="bgapi">bgapi</h2>

            </div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Send an API command in the background. Wraps it inside a Promise.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  bgapi: <span class="hljs-function"><span class="hljs-params">(command)</span> -&gt;</span>
    trace <span class="hljs-string">'bgapi'</span>, {command}

    <span class="hljs-keyword">if</span> @closed
      <span class="hljs-keyword">return</span> @error {}, {when:<span class="hljs-string">'bgapi on closed socket'</span>,command}

    @send <span class="hljs-string">"bgapi <span class="hljs-subst">#{command}</span>"</span>
    .<span class="hljs-keyword">then</span> (res) =&gt;
<span class="hljs-function">      <span class="hljs-title">error</span> = =&gt;</span> @error res, {when:<span class="hljs-string">"bgapi did not provide a Job-UUID"</span>,command}

      <span class="hljs-keyword">return</span> error() <span class="hljs-keyword">unless</span> res?
      reply = res.headers[<span class="hljs-string">'Reply-Text'</span>]
      r = reply?.match(<span class="hljs-regexp">/\+OK Job-UUID: (.+)$/</span>)?[<span class="hljs-number">1</span>]
      r ?= res.headers[<span class="hljs-string">'Job-UUID'</span>]
      <span class="hljs-keyword">return</span> error() <span class="hljs-keyword">unless</span> r?

      trace <span class="hljs-string">'bgapi retrieve'</span>, r

      @once <span class="hljs-string">"BACKGROUND_JOB <span class="hljs-subst">#{r}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <h1 id="event-reception-and-filtering">Event reception and filtering</h1>

            </div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <h2 id="event_json">event_json</h2>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Request that the server send us events in JSON format.
For example: <code>res.event_json &#39;HEARTBEAT&#39;</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  event_json: <span class="hljs-function"><span class="hljs-params">(events...)</span> -&gt;</span>

    @send <span class="hljs-string">"event json <span class="hljs-subst">#{events.join(<span class="hljs-string">' '</span>)}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <h2 id="nixevents">nixevents</h2>

            </div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Remove the given event types from the events ACL.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  nixevent: <span class="hljs-function"><span class="hljs-params">(events...)</span> -&gt;</span>

    @send <span class="hljs-string">"nixevent <span class="hljs-subst">#{events.join(<span class="hljs-string">' '</span>)}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <h2 id="noevents">noevents</h2>

            </div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Remove all events types.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  noevents: <span class="hljs-function">-&gt;</span>

    @send <span class="hljs-string">"noevents"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <h2 id="filter">filter</h2>

            </div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Generic event filtering</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  filter: <span class="hljs-function"><span class="hljs-params">(header,value)</span> -&gt;</span>

    @send <span class="hljs-string">"filter <span class="hljs-subst">#{header}</span> <span class="hljs-subst">#{value}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <h2 id="filter_delete">filter_delete</h2>

            </div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Remove a filter.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  filter_delete: <span class="hljs-function"><span class="hljs-params">(header,value)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> value?
      @send <span class="hljs-string">"filter delete <span class="hljs-subst">#{header}</span> <span class="hljs-subst">#{value}</span>"</span>
    <span class="hljs-keyword">else</span>
      @send <span class="hljs-string">"filter delete <span class="hljs-subst">#{header}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <h2 id="sendevent">sendevent</h2>

            </div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>Send an event into the FreeSwitch event queue.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sendevent: <span class="hljs-function"><span class="hljs-params">(event_name,args)</span> -&gt;</span>

    @send <span class="hljs-string">"sendevent <span class="hljs-subst">#{event_name}</span>"</span>, args</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <h1 id="connection-handling">Connection handling</h1>

            </div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <h2 id="auth">auth</h2>

            </div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Authenticate with FreeSwitch.</p>
<p>This normally not needed since in outbound (server) mode authentication is not required, and for inbound (client) mode the module authenticates automatically when requested.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  auth: <span class="hljs-function"><span class="hljs-params">(password)</span>       -&gt;</span> @send <span class="hljs-string">"auth <span class="hljs-subst">#{password}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <h2 id="connect">connect</h2>

            </div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Used in server mode to start the conversation with FreeSwitch.</p>
<p>Normally not needed, triggered automatically by the module.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  connect: <span class="hljs-function">-&gt;</span> @send <span class="hljs-string">"connect"</span>    <span class="hljs-comment"># Outbound mode</span></pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h2 id="linger">linger</h2>

            </div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>Used in server mode, requests FreeSwitch to not close the socket as soon as the call is over, allowing us to do some post-processing on the call (mainly, receiving call termination events).
By default, <code>esl</code> with call <code>exit()</code> for you after 4 seconds. You need to capture the <code>cleanup_linger</code> event if you want to handle things differently.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  linger: <span class="hljs-function">-&gt;</span> @send <span class="hljs-string">"linger"</span>     <span class="hljs-comment"># Outbound mode</span></pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <h2 id="exit">exit</h2>

            </div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>Send the <code>exit</code> command to the FreeSwitch socket.
FreeSwitch will respond with “+OK bye” followed by a <code>disconnect-notice</code> message, which gets translated into a <code>freeswitch_disconnect_notice</code> event internally, which in turn gets translated into either <code>freeswitch_disconnect</code> or <code>freeswitch_linger</code> depending on whether <code>linger</code> was called on the socket.
You normally do not need to call <code>@exit</code> directly. If you do, make sure you do handle any rejection.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  exit: <span class="hljs-function">-&gt;</span> @send <span class="hljs-string">"exit"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <h1 id="event-logging">Event logging</h1>

            </div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <h2 id="log">log</h2>

            </div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Enable logging on the socket, optionnally setting the log level.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  log: <span class="hljs-function"><span class="hljs-params">(level)</span> -&gt;</span>
    <span class="hljs-keyword">if</span> level?
      @send <span class="hljs-string">"log <span class="hljs-subst">#{level}</span>"</span>
    <span class="hljs-keyword">else</span>
      @send <span class="hljs-string">"log"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <h2 id="nolog">nolog</h2>

            </div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Disable logging on the socket.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  nolog: <span class="hljs-function">-&gt;</span> @send <span class="hljs-string">"nolog"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <h1 id="message-sending">Message sending</h1>

            </div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <h2 id="sendmsg_uuid">sendmsg_uuid</h2>

            </div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Send a command to a given UUID.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sendmsg_uuid: <span class="hljs-function"><span class="hljs-params">(uuid,command,args)</span> -&gt;</span>

    options = args ? {}
    options[<span class="hljs-string">'call-command'</span>] = command
    execute_text = <span class="hljs-keyword">if</span> uuid? <span class="hljs-keyword">then</span> <span class="hljs-string">"sendmsg <span class="hljs-subst">#{uuid}</span>"</span> <span class="hljs-keyword">else</span> <span class="hljs-string">'sendmsg'</span>
    @send execute_text, options</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <h2 id="sendmsg">sendmsg</h2>

            </div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <p>Send Message, assuming server/outbound ESL mode (in which case the UUID is not required).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  sendmsg: <span class="hljs-function"><span class="hljs-params">(command,args)</span> -&gt;</span> @sendmsg_uuid <span class="hljs-literal">null</span>, command, args</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h1 id="client-mode-inbound-commands">Client-mode (“inbound”) commands</h1>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <p>The target UUID must be specified.</p>
<h2 id="execute_uuid">execute_uuid</h2>

            </div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>Execute an application for the given UUID (in client mode).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  execute_uuid: <span class="hljs-function"><span class="hljs-params">(uuid,app_name,app_arg,loops)</span> -&gt;</span>
    options =
      <span class="hljs-string">'execute-app-name'</span>: app_name
      <span class="hljs-string">'execute-app-arg'</span>:  app_arg
    options.loops = loops <span class="hljs-keyword">if</span> loops?
    @sendmsg_uuid uuid, <span class="hljs-string">'execute'</span>, options</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>TODO: Support the alternate format (with no <code>execute-app-arg</code> header but instead a <code>text/plain</code> body containing the argument).</p>
<h2 id="command_uuid">command_uuid</h2>

            </div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>Execute an application synchronously. Return a Promise.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  command_uuid: <span class="hljs-function"><span class="hljs-params">(uuid,app_name,app_arg)</span> -&gt;</span>
    app_arg ?= <span class="hljs-string">''</span>
    event = <span class="hljs-keyword">if</span> uuid?
        <span class="hljs-string">"CHANNEL_EXECUTE_COMPLETE <span class="hljs-subst">#{uuid}</span> <span class="hljs-subst">#{app_name}</span> <span class="hljs-subst">#{app_arg}</span>"</span>
      <span class="hljs-keyword">else</span>
        <span class="hljs-string">"CHANNEL_EXECUTE_COMPLETE <span class="hljs-subst">#{app_name}</span> <span class="hljs-subst">#{app_arg}</span>"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>The Promise is only fulfilled when the command has completed.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    result = @once event
    @execute_uuid uuid,app_name,app_arg
    .<span class="hljs-keyword">then</span> -&gt;
      result</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <h2 id="hangup_uuid">hangup_uuid</h2>

            </div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Hangup the call referenced by the given UUID with an optional (FreeSwitch) cause code.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  hangup_uuid: <span class="hljs-function"><span class="hljs-params">(uuid,hangup_cause)</span> -&gt;</span>
    hangup_cause ?= <span class="hljs-string">'NORMAL_UNSPECIFIED'</span>
    options =
      <span class="hljs-string">'hangup-cause'</span>: hangup_cause
    @sendmsg_uuid uuid, <span class="hljs-string">'hangup'</span>, options</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <h2 id="unicast_uuid">unicast_uuid</h2>

            </div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Forwards the media to and from a given socket.</p>
<p>Arguments:</p>
<ul>
<li><code>local-ip</code></li>
<li><code>local-port</code></li>
<li><code>remote-ip</code></li>
<li><code>remote-port</code></li>
<li><code>transport</code> (<code>tcp</code> or <code>udp</code>)</li>
<li><code>flags: &quot;native&quot;</code> (optional: do not transcode to/from L16 audio)</li>
</ul>

            </div>
            
            <div class="content"><div class='highlight'><pre>  unicast_uuid: <span class="hljs-function"><span class="hljs-params">(uuid,args)</span> -&gt;</span>
    @sendmsg_uuid uuid, <span class="hljs-string">'unicast'</span>, args</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <h2 id="nomedia_uuid">nomedia_uuid</h2>

            </div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-79">&#182;</a>
              </div>
              <p>Not implemented yet (TODO).</p>
<h1 id="server-mode-commands">Server-mode commands</h1>

            </div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-80">&#182;</a>
              </div>
              <p>In server (outbound) mode, the target UUID is always our (own) call UUID, so it does not need to be specified.</p>
<h2 id="execute">execute</h2>

            </div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-81">&#182;</a>
              </div>
              <p>Execute an application for the current UUID (in server/outbound mode)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  execute: <span class="hljs-function"><span class="hljs-params">(app_name,app_arg)</span>  -&gt;</span> @execute_uuid <span class="hljs-literal">null</span>, app_name, app_arg</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-82">&#182;</a>
              </div>
              <h2 id="command">command</h2>

            </div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-83">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  command: <span class="hljs-function"><span class="hljs-params">(app_name,app_arg)</span>  -&gt;</span> @command_uuid <span class="hljs-literal">null</span>, app_name, app_arg</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-84">&#182;</a>
              </div>
              <h2 id="hangup">hangup</h2>

            </div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-85">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  hangup: <span class="hljs-function"><span class="hljs-params">(hangup_cause)</span>       -&gt;</span> @hangup_uuid  <span class="hljs-literal">null</span>, hangup_cause</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-86">&#182;</a>
              </div>
              <h2 id="unicast">unicast</h2>

            </div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-87">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>  unicast: <span class="hljs-function"><span class="hljs-params">(args)</span>              -&gt;</span> @unicast_uuid <span class="hljs-literal">null</span>, args</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-88">&#182;</a>
              </div>
              <p>TODO: <code>nomedia</code></p>
<h1 id="cleanup-at-end-of-call">Cleanup at end of call</h1>

            </div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-89">&#182;</a>
              </div>
              <h2 id="auto_cleanup">auto_cleanup</h2>

            </div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-90">&#182;</a>
              </div>
              <p>Clean-up at the end of the connection.
Automatically called by the client and server.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  auto_cleanup: <span class="hljs-function">-&gt;</span>
    @once <span class="hljs-string">'freeswitch_disconnect_notice'</span>, <span class="hljs-function"><span class="hljs-params">(res)</span> =&gt;</span>
      trace <span class="hljs-string">'auto_cleanup: Received ESL disconnection notice'</span>, res
      <span class="hljs-keyword">switch</span> res.headers[<span class="hljs-string">'Content-Disposition'</span>]
        <span class="hljs-keyword">when</span> <span class="hljs-string">'linger'</span>
          trace <span class="hljs-string">'Sending freeswitch_linger'</span>
          @emit <span class="hljs-string">'freeswitch_linger'</span>
        <span class="hljs-keyword">when</span> <span class="hljs-string">'disconnect'</span>
          trace <span class="hljs-string">'Sending freeswitch_disconnect'</span>
          @emit <span class="hljs-string">'freeswitch_disconnect'</span>
        <span class="hljs-keyword">else</span> <span class="hljs-comment"># Header might be absent?</span>
          trace <span class="hljs-string">'Sending freeswitch_disconnect'</span>
          @emit <span class="hljs-string">'freeswitch_disconnect'</span></pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-91">&#182;</a>
              </div>
              <h3 id="linger">Linger</h3>
<p>In linger mode you may intercept the event <code>cleanup_linger</code> to do further processing. However you are responsible for calling <code>exit()</code>. If you do not do it, the calls will leak. (Make sure you also <code>catch</code> any errors on exit: <code>exit().catch(...)</code>.)</p>
<p>The default behavior in linger mode is to disconnect the socket after 4 seconds, giving you some time to capture events.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    linger_delay = <span class="hljs-number">4000</span>

    @once <span class="hljs-string">'freeswitch_linger'</span>, <span class="hljs-function">-&gt;</span>
      trace <span class="hljs-string">'auto_cleanup/linger'</span>
      <span class="hljs-keyword">if</span> @emit <span class="hljs-string">'cleanup_linger'</span>
        debug <span class="hljs-string">'auto_cleanup/linger: cleanup_linger processed, make sure you call exit()'</span>
      <span class="hljs-keyword">else</span>
        trace <span class="hljs-string">"auto_cleanup/linger: exit() in <span class="hljs-subst">#{linger_delay}</span>ms"</span>
        Promise.delay linger_delay
        .bind <span class="hljs-keyword">this</span>
        .<span class="hljs-keyword">then</span> -&gt;
          trace <span class="hljs-string">'auto_cleanup/linger: exit()'</span>
          @exit()
        .<span class="hljs-keyword">catch</span> (error) -&gt;
          debug <span class="hljs-string">"auto_cleanup/linger: exit() error: <span class="hljs-subst">#{error}</span> (ignored)"</span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-92">&#182;</a>
              </div>
              <h3 id="disconnect">Disconnect</h3>
<p>On disconnect (no linger) mode, you may intercept the event <code>cleanup_disconnect</code> to do further processing. However you are responsible for calling <code>end()</code> in order to close the socket.</p>
<p>Normal behavior on disconnect is to close the socket with <code>end()</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    @once <span class="hljs-string">'freeswitch_disconnect'</span>, <span class="hljs-function">-&gt;</span>
      trace <span class="hljs-string">'auto_cleanup/disconnect'</span>
      <span class="hljs-keyword">if</span> @emit <span class="hljs-string">'cleanup_disconnect'</span>, <span class="hljs-keyword">this</span>
        debug <span class="hljs-string">'auto_cleanup/disconnect: cleanup_disconnect processed, make sure you call end()'</span>
      <span class="hljs-keyword">else</span>
        trace <span class="hljs-string">'auto_cleanup/disconnect: end()'</span>
        @end()

    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span></pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-93">&#182;</a>
              </div>
              <h1 id="toolbox">Toolbox</h1>

            </div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-94">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre>Promise = <span class="hljs-built_in">require</span> <span class="hljs-string">'bluebird'</span>
assert = <span class="hljs-built_in">require</span> <span class="hljs-string">'assert'</span>
{EventEmitter} = <span class="hljs-built_in">require</span> <span class="hljs-string">'events'</span>
debug = (<span class="hljs-built_in">require</span> <span class="hljs-string">'debug'</span>) <span class="hljs-string">'esl:response'</span>
trace = (<span class="hljs-built_in">require</span> <span class="hljs-string">'debug'</span>) <span class="hljs-string">'esl:response:trace'</span></pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
